<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>安手账</title>
    <script src="js/jquery/2.0.0/jquery.min.js"></script>
    <link href="css/bootstrap/3.3.6/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap/3.3.6/bootstrap.min.js"></script>
    <script src="js/vue/2.5.16/vue.min.js"></script>
    <script src="js/axios/0.17.1/axios.min.js"></script>
    <script>
        $(function(){
            var data4Vue = {
                uri:'addtlist',
                beans: [],
                tlist: {in_ex:'',amount:'',tid:'',remarks:'',datetime:''}
            };
            //ViewModel
            var vue = new Vue({
                el: '#workingArea',
                data: data4Vue,
                mounted:function(){ //mounted　表示这个 Vue 对象加载成功了
                    this.list();
                },
                methods: {
                    list:function(){
                        var url =  this.uri;
                        axios.get(url).then(function(response) {
                            vue.beans = response.data;
                        });
                    },
                    addbill:function(){
                        var url =  this.uri;
                        if(0==this.tlist.in_ex.length){
                            $("span.errorMessage").html("收支选项不可为空");
                            $("div.addbillErrorMessageDiv").css("visibility","visible");
                            return;
                        }
                        if(0==this.tlist.amount){
                            $("span.errorMessage").html("金额不可为空");
                            $("div.addbillErrorMessageDiv").css("visibility","visible");
                            return;
                        }
                        if(0==this.tlist.tid.length){
                            $("span.errorMessage").html("分类不可为空");
                            $("div.addbillErrorMessageDiv").css("visibility","visible");
                            return;
                        }
                        if(0==this.tlist.datetime){
                            $("span.errorMessage").html("时间不可为空");
                            $("div.addbillErrorMessageDiv").css("visibility","visible");
                            return;
                        }

                        axios.post(url,this.tlist).then(function(response) {
                            var result = response.data;
                            if(result.code==0){
                                alert("新增成功");
                                location.href="index";
                            }
                            else{
                                $("span.errorMessage").html(result.message);
                                $("div.loginErrorMessageDiv").css("visibility","visible");
                            }
                        });
                    }

                },

            });
        });

    </script>
</head>
<body ng-app="app" ng-controller="MainController">
<h1>安手账新增账单</h1>
<div id="workingArea">
    <div class="addbillDiv">
        <div class="addbillErrorMessageDiv">
            <div class="alert alert-danger" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>
                <span class="errorMessage"></span>
            </div>
        </div>
        <table cellspacing="1" style="background-color: #a0c6e5">
            <tr>
                <td>收入 or 支出</td>
                <td><input name="in_ex" v-model="tlist.in_ex" type="radio" value="0"/>支出
                    <input name="in_ex" v-model="tlist.in_ex" type="radio" value="1"/>收入
                </td>
            </tr>
            <tr>
                <td>金额：</td>
                <td><input  v-model="tlist.amount" type="text"/></td>
            </tr>
            <tr >
                <td>分类:</td>
                <td v-for="bean in beans">{{bean.id}} {{bean.type}}</td>
                <td>
                <select v-model="tlist.tid">
                    <option disabled value="">请选择</option>
                    <option v-for="bean in beans">{{bean.id}}</option>
                </select>
                </td>
            </tr>
            
            <tr>
                <td>备注：</td>
                <td><input  v-model="tlist.remarks" type="text"/></td>
            </tr>
            <tr>
                <td>时间：</td>
                <td><input v-model="tlist.datetime" type="datetime-local" > </td>
            </tr>
        </table>
        <a  @click="addbill"><input type="button" value="确认"/></a>
    </div>
</div>
</body>
</html>